FROM node:16-alpine

ENV REACT_APP_API_URL='$CESB' \
    REACT_APP_KEYCLOAK_SERVICE_URL='$KEYCLOAK' \
    REACT_APP_JSREPORT_SERVICE_URL='$JSREPORT' \
    REACT_APP_DDC_INFO_SERVICE_URL='$DDCINFO' \
    REACT_APP_DDC_ROUTER_SERVICE_URL='$DDCROUTER' \
    REACT_APP_BPM_SERVICE_URL='$BPMSERV' \
    REACT_APP_BPM_ENGINE_REST_URL='$BPMENGINE' \
    REACT_APP_FILE_STORAGE_SERVICE_URL='$FILESTORAGE' \
    REACT_APP_GATEWAY_SERVICES_URL='$GATEWAY' \
    REACT_APP_SYSEVN_SERVICE_URL='$SYSEVN' \
    REDIS_HOST='$REDIS_HOST' \
    REDIS_PORT='$REDIS_PORT'

RUN apk add --no-cache git

RUN git clone --branch $BRANCH https://$NEXUS_LOGIN:$NEXUS_PASS@gitlab.colvir.ru/v4web/colvir-ms/nodejs/report.git /usr/src/app

WORKDIR /usr/src/app
RUN yarn install
RUN yarn run build

CMD ["node", "dist/main"]